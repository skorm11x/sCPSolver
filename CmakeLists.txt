cmake_minimum_required(VERSION 3.30)
project(scpsolver LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

add_executable(scpsolver
    src/server.cpp
    src/routes.cpp
    src/routes/RootHandler.cpp
    src/routes/CSPSolverHandler.cpp
    src/engine/CSPScheduler.cpp
    lib/civetweb/src/CivetServer.cpp
)

# TODO: move this within platform specific sections as well
set(ORTOOLS_ROOT "${CMAKE_SOURCE_DIR}/lib/or-tools")

find_package(ortools REQUIRED PATHS ${ORTOOLS_ROOT}/lib/cmake/ortools NO_DEFAULT_PATH)
target_link_libraries(scpsolver PRIVATE ortools::ortools)

if(APPLE)
    target_include_directories(scpsolver PRIVATE ${CMAKE_SOURCE_DIR}/lib/civetweb/include)
    target_link_directories(scpsolver PRIVATE ${CMAKE_SOURCE_DIR}/lib/civetweb)
    target_link_libraries(scpsolver PRIVATE civetweb pthread dl)

    set_target_properties(scpsolver PROPERTIES
        BUILD_RPATH "/lib/civetweb"
        INSTALL_RPATH "/lib/civetweb"
        MACOSX_RPATH ON
    )
else()
    target_link_libraries(scpsolver PRIVATE civetweb pthread dl)
endif()
